---
title: "[데이터베이스] 뷰"
categories:
  - DataBase
tags:
  - DataBase
comments:
  - true
read_time: false
toc: true
toc_sticky: true
---
뷰는 일반 테이블과 다르게 데이터를 실제로 저장하고 있지 않은 다른 테이블을 기반으로 만들어진 가상 테이블이다. 

물리적으로 존재하면서 실제로 데이터를 저장하는 일반 테이블과 다르게 뷰는 논리적으로만 존재하면서 일반 테이블과 동일한 방법으로 사용할 수 있다.

뷰를 만드는 데 기반이 되는 물리적 테이블은 기본 테이블이라 하며, 이는 우리가 흔히 쓰는 CREATE TABLE로 정의한 테이블을 말한다. 

뷰는 기본 테이블을 기반으로 만들어지지만, 다른 뷰를 기반으로도 새로운 뷰를 만들 수 있다.

## 뷰의 생성
뷰의 생성과 삭제 역시 SQL의 정의 기능에 해당한다.

뷰를 생성하기 위해 필요한 SQL 명령어는 CREATE VIEW 이다.

```
CREATE VIEW 뷰이름[(속성 리스트)]
AS SELECT 문
[WITH CHECK OPTION]
```

CREATE VIEW 명령어와 새로 생성할 뷰의 이름을 먼저 제시한다. 그 후, 뷰를 구성하는 속성의 이름을 괄호안에 나열하되 생략할 수 있다.

AS 키워드와 함께 기본 테이블에 대한 SELECT 문을 작성한다. SELECT 문은 생성하고자 하는 뷰의 정의를 담고 있고, ORDER BY를 사용할 수 없다는 점만 제외하면 일반 SELECT 문과 동일하다.

위에서 언급한 것 처럼 뷰를 구성하는 속성의 이름을 생략할 경우 SELECT 절에 나열된 속성의 이름을 뷰에서도 그대로 사용할 수 있게 된다.

WITH CHECK OPTION은 생성한 뷰에 삽입이나 수정 연산을 할 때, SELECT 문에서 제시한 뷰의 정의 조건을 위반하면 수행되지 않도록 하는 제약 조건을 의미한다.

예를 들어, 사용자 테이블에서 팀이 아슬란인 사용자들의 아이디,이름,나이로 구성된 아슬란사용자 뷰를 생성한다고 할 때, WITH CHECK OPTION을 쓰게 되면, 

팀이 아슬란이 아닌 사용자 데이터를 삽입하거나, 뷰의 정의 조건을 위반하는 수정 및 삭제 연산을 시도하면 실행하지 않고 거부된다.

## 뷰의 활용
CREATE VIEW로 생성된 뷰에서도 일반 테이블과 똑같이 원하는 데이터를 검색할 수 있다.

```
SELECT * FROM 뷰이름 WHERE 조건
```

여기서 궁금한 점이 하나 생긴다. 뷰는 실제로 데이터를 저장하고 있지 않는 가상테이블이었는데 SELECT 문으로 데이터를 검색할 수 있는 이유는 무엇일까?

이유는 뷰에 대한 SELECT 문이 내부적으로는 기본 테이블에 대한 SELECT 문으로 변환되어 수행되기 때문이다.

INSERT, DELETE, UPDATE 역시 뷰를 대상으로 수행할 수 있다.

이 역시도 기본 테이블에 수행되기 때문에 결과적으로는 기본 테이블이 변한다. 하지만, 삽입, 수정, 삭제 연산은 모든 뷰에 허용되지 않는다. 즉 제한적이다.

삽입, 수정, 삭제 연산이 허용되지 않는 뷰에 대해 알아보자.

__먼저, 기본 테이블의 기본키를 구성하는 속성이 포함되어 있지 않은 뷰는 변경할 수 없다__ 

위에서 언급한 것 처럼, 뷰에 대한 삽입,수정,삭제 연산은 기본 테이블이 변한다. 만약, 기본 테이블을 통해 뷰를 만든 후, 그 뷰에 INSERT 문을 수행하면, 기본 테이블에도 데이터가 추가된다. 하지만 이 때, 기본테이블의 pk 속성이 뷰에는 없었다고 해보자. 그러면, 기본 테이블에 삽입된 데이터는 pk 속성 값을 가지고 있지 않게 된다. 

즉, 기본 테이블의 기본키를 구성하는 속성이 포함되어있지 않은 뷰는 변경할 수 없게 되는 것이다.

__두번째로, 기본 테이블에 있던 내용이 아닌 집계 함수로 새로 계산된 내용을 포함하고 있는 뷰는 변경할 수 없다.__

집계 함수로 계산된 값은 기본 테이블에 원래 포함하고 있던 내용이 아니라 새로 계산된 값이다.

따라서, 삽입,수정 삭제 연산을 할 때 어떤 튜플을 어떻게 변화시켜야 하는지가 명확하지 않다.

__세번째로, DISTINCT 키워드를 포함하여 정의한 뷰는 변경할 수 없다__

DISTINCT 키워드를 통해 뷰를 정의하면 기본 테이블의 튜플이 어떤 속성을 기준으로 중복되는 부분은 제거하고 보여준다.

만약 이렇게 만든 뷰의 튜플을 업데이트하면 역시나 기본 테이블의 튜플을 어떻게 변화시켜야 하는지 명확하지 않다.

__네번째로, GROUP BY 절을 포함하여 정의한 뷰는 변경할 수 없다__
역시나 같은 맥락에서 이해하면 된다.

__마지막으로, 여러 개의 테이블을 조인하여 정의한 뷰 역시 변경할 수 없는 경우가 많다.__

그럼에도 불구하고 왜 굳이 번거롭게 뷰를 정의해서 사용하는 것일까?

뷰의 장점에 대해 알아보자!

## 뷰의 장점
__먼저, 뷰를 사용하면 질의문을 좀 더 쉽게 작성할 수 있게 된다.__

특정 조건을 만족하는 튜플들로 뷰를 미리 만들어놓으면, 질의문 작성 시, 사용자가 WHERE 절 없이 뷰를 검색해도 특정 조건을 만족하는 데이터를 검색할 수 있다.

__두번째로, 데이터의 보안 유지에 도움이 된다.__
여러 사용자의 요구에 맞는 다양한 뷰를 미리 정의해두고 사용자가 자신에게 제공된 뷰를 통해서만 데이터에 접근하도록 권한을 설정하면, 뷰에 포함되지 않은 데이터를 사용자로부터 보호할 수 있다.

__세번째로, 데이터를 좀 더 편리하게 관리할 수 있다.__
제공된 뷰에 포함되지 않은 기본 테이블의 다른 부분은 사용자가 신경쓸 필요가 없다. 

## 뷰의 삭제
뷰를 삭제하기 위한 SQL 명령어는 DROP VIEW 이다.

```
DROP VIEW 뷰이름;
```

뷰를 삭제하더라도 기본 테이블은 영향을 받지 않는다. 만약 삭제할 뷰를 참조하는 제약조건이 존재한다면 삭제가 수행되지 않는다.

제약조건을 먼저 삭제하자! 

## 출처
__데이터베이스 개론 2판, 한빛아카데미__
